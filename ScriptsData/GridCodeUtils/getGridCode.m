function code = getGridCode(name)
% GETGRIDCODE Returns grid code compliance parameters for a given standard.
% All thresholds and requirements are generalized approximations that reflect common industry practice.
% Supported grid codes: 'IEEE2800', 'ENTSOE', 'CEA', 'UK', 'AEMO'
% Copyright 2025 - 2026 The MathWorks, Inc.

% Output 'code' includes:
% - voltage: min, max
% - frequency: min, max
% - harmonics: currentLimits, voltageLimits
% - frt: [voltageLimit, maxDuration]
% - frt_freq: [frequencyLimit, maxDuration]
% - reactive:
%   - Qlimits: Q range as function of P
%   - VQcurve: Q limits based on V (undervoltage and overvoltage)

switch upper(name)
    case 'IEEE2800'
        code.voltage = struct('min', 0.9,  'max', 1.05);
        code.frequency = struct('min', 58.8, 'max', 61.2);
        code.harmonics.currentLimits = [0.04 * ones(1,10), 0.02 * ones(1,6), 0.015 * ones(1,34)];
        code.harmonics.voltageLimits = [0.03 * ones(1,10), 0.015 * ones(1,6), 0.01 * ones(1,34)];
        code.lvrt = [1.2, 0.0; 1.1, 1.0; 1.05, 1800.0; 0.9, 1.5; 0.7, 0.7; 0.45, 0.15; 0, 0.15];
        code.LVRTreactive = struct( ...
            'minVoltage', 0.9, ...
            'minReactive', 0.3, ...
            'responseDelay', 0.1 ...
            );
        code.frt_freq = [57, 10.0; 59, 300.0; 61, 300.0; 63, 10.0];
        code.reactive.Qlimits  = @(P) [-sqrt(max(0, 1 - P.^2)), sqrt(max(0, 1 - P.^2))];
        Vpts = [0.00 0.90 1.00 1.04 1.088 1.10 1.20];
        Qpts = [+0.23 +0.23 0 -0.1 -0.3287 -0.3287 -0.3287];

        code.reactive.VQcurve = @(V) deal( ...
            min([interp1(Vpts, Qpts, V, 'linear', 'extrap'), ...
            ones(size(V)) .* sign(interp1(Vpts, Qpts, V, 'linear', 'extrap'))]), ...
            max([interp1(Vpts, Qpts, V, 'linear', 'extrap'), ...
            ones(size(V)) .* sign(interp1(Vpts, Qpts, V, 'linear', 'extrap'))])...
            );

    case 'ENTSOE'
        code.voltage = struct('min', 0.85, 'max', 1.10);
        code.frequency = struct('min', 47.5, 'max', 51.5);
        code.harmonics.currentLimits = 0.04 * ones(1,50);
        code.harmonics.voltageLimits = 0.03 * ones(1,50);
        code.lvrt = [1.21, 0.0; 1.2, 0.2; 1.15, 1.0; 1.1, 5.0; 1.05, 1800.0; 0.9, 3; 0.85, 1; 0.3, 0.3; 0 0.14];
        code.LVRTreactive = struct( ...
            'minVoltage', 0.9, ...
            'minReactive', 0.3, ...
            'responseDelay', 0.05 ...
            );
        code.frt_freq = [47.5, 20.0; 48.5, 60.0; 51.5, 60.0; 52.0, 20.0];
        code.reactive.Qlimits  = @(P) [-sqrt(max(0, 1 - P.^2)), sqrt(max(0, 1 - P.^2))];
        Vpts = [0.0 0.90 0.95 1.00 1.05 1.10 1.20];
        Qpts = [+0.33 +0.33 +0.25 0 -0.25 -0.33 -0.33];
        code.reactive.VQcurve = @(V) deal( ...
            min([interp1(Vpts, Qpts, V, 'linear', 'extrap'), ...
            ones(size(V)) .* sign(interp1(Vpts, Qpts, V, 'linear', 'extrap'))]), ...
            max([interp1(Vpts, Qpts, V, 'linear', 'extrap'), ...
            ones(size(V)) .* sign(interp1(Vpts, Qpts, V, 'linear', 'extrap'))])...
            );
    case 'CEA'
        code.voltage = struct('min', 0.85, 'max', 1.10);
        code.frequency = struct('min', 47.5, 'max', 52.0);
        code.harmonics.currentLimits = 0.05 * ones(1,50);
        code.harmonics.voltageLimits = 0.04 * ones(1,50);
        code.lvrt = [1.21, 0.0; 1.2, 0.2; 1.1, 2.0; 1.05, 1800.0; 0.9, 2; 0.3, 0.5; 0 0.2];
        code.frt_freq = [47.5, 10.0; 48.5, 60.0; 51.5, 60.0; 52.0, 10.0];
        code.LVRTreactive = struct( ...
            'minVoltage', 0.9, ...
            'minReactive', 0.3, ...
            'responseDelay', 0.05 ...
            );
        code.reactive.Qlimits  = @(P) [-0.5 * ones(size(P)), 0.5 * ones(size(P))];
        Vpts = [0.0 0.90 0.95 1.00 1.05 1.10 1.20];
        Qpts = [+0.44 +0.44 +0.3 0 -0.3 -0.44 -0.44];  % India uses Â±44% in some specs
        code.reactive.VQcurve = @(V) deal( ...
            min([interp1(Vpts, Qpts, V, 'linear', 'extrap'), ...
            ones(size(V)) .* sign(interp1(Vpts, Qpts, V, 'linear', 'extrap'))]), ...
            max([interp1(Vpts, Qpts, V, 'linear', 'extrap'), ...
            ones(size(V)) .* sign(interp1(Vpts, Qpts, V, 'linear', 'extrap'))])...
            );

    case 'UK'
        code.voltage = struct('min', 0.85, 'max', 1.10);
        code.frequency = struct('min', 47.5, 'max', 52.0);
        code.harmonics.currentLimits = 0.03 * ones(1,50);
        code.harmonics.voltageLimits = 0.025 * ones(1,50);
        code.lvrt = [1.2, 0.0; 1.18, 0.5; 1.15, 1.0; 1.1, 10.0; 1.05, 1800.0; 0.9, 3; 0.85, 1; 0.3, 0.3; 0 0.14];
        code.LVRTreactive = struct( ...
            'minVoltage', 0.9, ...
            'minReactive', 0.3, ...
            'responseDelay', 0.05 ...
            );
        code.frt_freq = [47.5, 20.0; 48.5, 60.0; 51.5, 60.0; 52.0, 20.0];
        code.reactive.Qlimits  = @(P) [-sqrt(max(0, 1 - P.^2)), sqrt(max(0, 1 - P.^2))];
        Vpts = [0.0 0.90 0.95 1.00 1.05 1.10 1.20];
        Qpts = [+0.33 +0.33 +0.2 0 -0.2 -0.33 -0.33];
        code.reactive.VQcurve = @(V) deal( ...
            min([interp1(Vpts, Qpts, V, 'linear', 'extrap'), ...
            ones(size(V)) .* sign(interp1(Vpts, Qpts, V, 'linear', 'extrap'))]), ...
            max([interp1(Vpts, Qpts, V, 'linear', 'extrap'), ...
            ones(size(V)) .* sign(interp1(Vpts, Qpts, V, 'linear', 'extrap'))])...
            );

    case 'AEMO'
        code.voltage = struct('min', 0.85, 'max', 1.10);
        code.frequency = struct('min', 49.0, 'max', 51.0);
        code.harmonics.currentLimits = 0.02 * ones(1,50);
        code.harmonics.voltageLimits = 0.015 * ones(1,50);
        code.lvrt = [1.21, 0.0; 1.2, 0.2; 1.15, 1.0; 1.1, 5.0; 1.05, 1800.0; 0.9, 2; 0.7, 0.7; 0.4, 0.3; 0 0.15];
        code.LVRTreactive = struct( ...
            'minVoltage', 0.9, ...
            'minReactive', 0.3, ...
            'responseDelay', 0.03 ...
            );
        code.frt_freq = [47.5, 20.0; 49.0, 300.0; 51.0, 300.0; 52.0, 20.0];
        code.reactive.Qlimits  = @(P) [-0.44 * ones(size(P)), 0.44 * ones(size(P))];
        Vpts = [0.0 0.90 0.95 1.00 1.05 1.10 1.20];
        Qpts = [+0.33 +0.33 +0.25 0 -0.25 -0.33 -0.33];
        code.reactive.VQcurve = @(V) deal( ...
            min([interp1(Vpts, Qpts, V, 'linear', 'extrap'), ...
            ones(size(V)) .* sign(interp1(Vpts, Qpts, V, 'linear', 'extrap'))]), ...
            max([interp1(Vpts, Qpts, V, 'linear', 'extrap'), ...
            ones(size(V)) .* sign(interp1(Vpts, Qpts, V, 'linear', 'extrap'))])...
            );

    otherwise
        error('Unknown grid code name: "%s". Valid options: IEEE2800, ENTSOE, CEA, UK, AEMO.', name);
end
end